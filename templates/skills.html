<!-- skills.html -->
{% extends "base.html" %}

{% block content %}

<style>
   
   #jobSkillsHeader {
       text-align: center;
       padding: 5px;
       margin: 5px;
   }

   #mySkillsHeader {
       text-align: center;
       padding: 5px;
       margin: 5px;
   }

   .table-container {
       margin: 40px auto; /* Add more space between tables and center horizontally */
   }

   .toggle-button {
       display: block; /* Display buttons as blocks to have them appear on separate lines */
       padding: 10px;
       margin: 10px auto; /* Add space between buttons and center horizontally */
       border-radius: 5%;
   }

   
    #jobSkillsHeader {
        text-align: center;
        padding: 5px;
        margin: 5px;
    }

    #mySkillsHeader {
        text-align: center;
        padding: 5px;
        margin: 5px;
    }

    #toggleTableButton {
        padding: 10px;
        margin: 10px;
        border-radius: 5%;
    }

</style>

<div class="table-container">
    <button id="toggleJobSkillsButton" onclick="toggleTable('jobSkillsDiv')">Skills Employers Want +</button>
    <div id="jobSkillsDiv" style="display: none;">
        <h2 id="jobSkillsHeader">In Demand Skills</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Skill</th>
                    <th>% of Jobs</th>
                    <th>Total Jobs</th>
                    <th>Learned</th>
                </tr>
            </thead>
            <tbody>
                {% for skill in job_skills %}
                <tr>
                    <td>{{ skill.skill }}</td>
                    <td>{{ skill.percentage }}</td>
                    <td>{{ skill.count }}</td>
                    <td>
                        {% if skill.learned %}
                            <span style="color: green;">&#x2714;</span>  <!-- Green checkmark -->
                        {% else %}
                            <span style="color: red;">&#x2718;</span>  <!-- Red X -->
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="table-container">
    <button id="toggleMySkillsButton" onclick="toggleTable('mySkillsDiv')">My Skills +</button>
    <div id="mySkillsDiv" style="display: none;">
        <h2 id="mySkillsHeader">My Skills</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Skill</th>
                    <th>Experience</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for skill in my_skills %}
                <tr>
                    <td>{{ skill.skill }}</td>
                    <td>{{ skill.experience }}</td>
                    <td><button class="edit-button" onclick="navigateToEditSkillsPage('{{ loop.index0 }}')">Edit</button></td>
                <td><button class="delete-button" onclick="confirmDelete('{{ loop.index0 }}')">Delete</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="add-container">
            <h3>Add Skill</h3>
            <button class="add-data-button" onclick="addNewSkill()">+</button>
        </div>
    </div>
</div>

<script>

    


    function navigateToEditSkillsPage(index) {
        // JavaScript code to navigate to the edit_jobs page with the jobId as a query parameter
        window.location.href = "{{ url_for('edit_skills') }}" + "?index=" + encodeURIComponent(index);
    }

    function addNewSkill() {
        // JavaScript code to add a new row with text boxes to the table
        const newRow = document.createElement("tr");
        newRow.style.verticalAlign = "top"; // Set the vertical alignment to top
        newRow.innerHTML = `
        
        <td><input type="text" class="input-box" placeholder="Skill"></td>
            <td><input type="text" class="input-box" placeholder="Experience Level"></td>
            <td><button class="save-button" onclick="saveSkill()">Save</button></td>
            <td><button class="cancel-button" onclick="refreshPage()">Cancel</button></td>
    `   ;
        document.querySelector("#mySkillsDiv tbody").appendChild(newRow);
    }
    
    function saveSkill() {
        // Get the form data
        const formElements = document.querySelectorAll("tbody tr:last-child input");
        const formData = {};
        formElements.forEach(input => {
            formData[input.getAttribute("placeholder")] = input.value;
        });
       
        // Send the form data to the /saveSkill route
        fetch("/saveSkill", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
        })
        .then((result) => {
            console.log("Skill saved successfully:");
            // Reload the page after saving the job
            refreshPage(); // This will refresh the page
        })
        .catch(error => {
            console.error("Error saving Skill:", error);
        });
    }
    
    function refreshPage() {
        window.location.href = "{{ url_for('skills') }}";
    }

    function toggleTable(tableId) {
        const table = document.getElementById(tableId);
        const button = tableId === "jobSkillsDiv" ? document.getElementById("toggleJobSkillsButton") : document.getElementById("toggleMySkillsButton");

        if (table.style.display === "none") {
            table.style.display = "table"; // Show the table
            button.innerText = tableId === "jobSkillsDiv" ? "Skills Employers Want -" : "My Skills -"; // Update the button text
        } else {
            table.style.display = "none"; // Hide the table
            button.innerText = tableId === "jobSkillsDiv" ? "Skills Employers Want +" : "My Skills +"; // Update the button text
        }
    }

</script>

{% endblock %}