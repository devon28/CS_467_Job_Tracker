{% extends "base.html" %}

{% block content %}
    <div class="table-container">
    <h2 class="page-header">Jobs</h2>

    <form class="data-form" style="display: none;">
        <input type="text" id="job-input" placeholder="Enter a job">
        <button type="submit">Save</button>
    </form>

    <table class="data-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Salary</th>
                <th>Skills</th>
                <th>Start Date</th>
                <th>Contact</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td>{{ job.title }}</td>
                <td>{{ job.salary }}</td>
                <td>{{ job.skills }}</td>
                <td>{{ job.start_date }}</td>
                <td>{{ job.contact }}</td>
                <td><button class="edit-button" onclick="navigateToEditJobsPage('{{ loop.index0 }}')">Edit</button></td>
                <td><button class="delete-button" onclick="confirmDelete('{{ loop.index0 }}')">Delete</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="add-container">
        <h3>Add Job</h3>
        <button class="add-data-button" onclick="addNewJob()">+</button>
    </div>
    

    <div class="add-container">
        <h3>Add Job</h3>
        <button class="add-data-button" onclick="addNewJob()">+</button>
    </div>
    </div>

    <script>
    function navigateToEditJobsPage(index) {
        // JavaScript code to navigate to the edit_jobs page with the jobId as a query parameter
        window.location.href = "{{ url_for('edit_jobs') }}" + "?index=" + encodeURIComponent(index);
    }
    
    function confirmDelete(index) {
        // Show a confirmation dialog
        const result = confirm("Are you sure you want to delete this job entry?");

        // Check the user's choice
        if (result) {
            // The user clicked "OK" (Yes), perform the delete action
            fetch("/deletejob", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ index: index }),
            })
            .then((result) => {
                console.log("Job deleted successfully:");
                // Reload the page after saving the job
                    refreshPage(); // This will refresh the page
            })
            .catch(error => {
                console.error("Error saving job:", error);
            });
        } else {
            // The user clicked "Cancel" (No), do nothing or handle as needed
            console.log("Delete canceled.");
        }
    }

    
    function addNewJob() {
        // JavaScript code to add a new row with text boxes to the table
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
            <td><input type="text" class="input-box" placeholder="Title"></td>
            <td><input type="text" class="input-box" placeholder="Salary"></td>
            <td>
                <div class="autocomplete">
                <input type="text" class="input-box skills-input" placeholder="Skills">
                <div class="autocomplete-items"></div>
                </div>
            </td>
            <td><input type="text" class="input-box" placeholder="Start Date"></td>
            <td><input type="text" class="input-box" placeholder="Contact"></td>
            <td><button class="save-button" onclick="saveJob()">Save</button></td>
            <td><button class="cancel-button" onclick="refreshPage()">Cancel</button></td>
        `;
        document.querySelector("tbody").appendChild(newRow);
    }
    
    function saveJob() {
        // Get the form data
        const formElements = document.querySelectorAll("tbody tr:last-child input");
        const formData = {};
        formElements.forEach(input => {
            formData[input.getAttribute("placeholder")] = input.value;
        });

        // Send the form data to the /savejob route
        fetch("/savejob", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
        })
        .then((result) => {
            console.log("Job saved successfully:");
            // Reload the page after saving the job
            refreshPage(); // This will refresh the page
        })
        .catch(error => {
            console.error("Error saving job:", error);
        });
        }
    
    function refreshPage() {
        window.location.href = "{{ url_for('jobs') }}";
    }


    
    </script>

{% endblock %}
